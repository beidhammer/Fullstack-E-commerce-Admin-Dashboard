<%- include('partials/header', { user, token }) %>
<h1>Brand Management</h1>
<table border="1">
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Options</th>
    </tr>
  </thead>
  <tbody>
    <% brands.forEach(b => { %>
      <tr>
        <td><%= b.id %></td>
        <td><%= b.name %></td>
        <td>
          <button onclick='openEditBrandModal(<%- JSON.stringify(b) %>)'>‚úèÔ∏è</button>
          <button onclick='deleteBrand(<%= b.id %>)'>üóë</button>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<div id="editBrandModal" style="display:none; position:fixed; top:10%; left:30%; background:white; padding:20px; border:1px solid #ccc;">
  <form id="editBrandForm">
    <input type="hidden" name="id" id="editBrandId">
    <label>Name:</label><br>
    <input type="text" id="editBrandName"><br><br>
    <button type="submit">Save</button>
    <button type="button" onclick="closeEditBrandModal()">Cancel</button>
  </form>
</div>

<script>
  function openEditBrandModal(b) {
    document.getElementById('editBrandModal').style.display = 'block';
    document.getElementById('editBrandId').value = b.id;
    document.getElementById('editBrandName').value = b.name;
  }

  function closeEditBrandModal() {
    document.getElementById('editBrandModal').style.display = 'none';
  }

  document.getElementById('editBrandForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const id = document.getElementById('editBrandId').value;
    const updatedBrand = {
      name: document.getElementById('editBrandName').value
    };

    try {
      const response = await fetch(`http://localhost:3000/brands/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + new URLSearchParams(window.location.search).get('token')
        },
        body: JSON.stringify(updatedBrand)
      });

      if (response.ok) {
        alert('Brand updated');
        location.reload();
      } else {
        alert('Failed to update brand');
      }
    } catch (error) {
      console.error('Update error:', error);
      alert('Something went wrong.');
    }
  });

  async function deleteBrand(id) {
    if (!confirm('Are you sure you want to delete this brand?')) return;
    try {
      const response = await fetch(`http://localhost:3000/brands/${id}`, {
        method: 'DELETE',
        headers: {
          'Authorization': 'Bearer ' + new URLSearchParams(window.location.search).get('token')
        }
      });

      if (response.ok) {
        alert('Brand deleted');
        location.reload();
      } else {
        alert('Failed to delete brand');
      }
    } catch (error) {
      console.error('Delete error:', error);
      alert('Something went wrong.');
    }
  }
</script>
